{% assign menus = site.data[page.menubar] %}

<aside class="menu">
  {% for menu in menus %}
    <p class="menu-label">{{ menu.label }}</p>
    <ul class="menu-list">
      {% for item in menu.items %}
        <li>
          {% assign is_external = item.link contains 'http' %}
          <a href="{% if is_external %}{{ item.link }}{% else %}{{ item.link | relative_url }}{% endif %}"
             class="{% if item.link == page.url %}is-active{% endif %}"
             {% if is_external %}target="_blank" rel="noopener noreferrer"{% endif %}>
            {{- item.name -}}
          </a>

          {% assign subitems = item.items | default: item.dropdown %}
          {% if subitems %}
            <ul>
              {% for subitem in subitems %}
                {% assign is_external_sub = subitem.link contains 'http' %}
                <li>
                  <a href="{% if is_external_sub %}{{ subitem.link }}{% else %}{{ subitem.link | relative_url }}{% endif %}"
                     class="{% if subitem.link == page.url %}is-active{% endif %}"
                     {% if is_external_sub %}target="_blank" rel="noopener noreferrer"{% endif %}>
                    {{- subitem.name -}}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endfor %}
</aside>
